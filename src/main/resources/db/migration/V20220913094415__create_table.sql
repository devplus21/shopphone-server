CREATE TABLE FILES
(
    ID            NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    RESOURCE_TYPE VARCHAR2(255) NOT NULL,
    PUBLIC_ID     VARCHAR2(255) NOT NULL,
    URL           VARCHAR2(1000) NOT NULL,
    CREATED_AT    TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT    TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (ID)
);

CREATE TABLE USERS
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    "NAME"     VARCHAR2(255),
    PASSWORD   VARCHAR2(255) NOT NULL,
    AVATAR     NUMBER NULL REFERENCES FILES(id),
    EMAIL      VARCHAR2(255) UNIQUE NOT NULL,
    STATUS     VARCHAR2(255) NOT NULL,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT CHECK_USER_STATUS CHECK (STATUS IN ('PENDING_VERIFICATION', 'ACTIVE', 'INACTIVE')),
    PRIMARY KEY (ID)
);


CREATE TABLE USER_RECOVERY
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    SECRET     VARCHAR2(255) NOT NULL,
    EXPIRES_AT TIMESTAMP WITH TIME ZONE,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    USER_ID    NUMBER UNIQUE                                      NOT NULL REFERENCES USERS (ID) ON DELETE CASCADE,
    PRIMARY KEY (id)
);


CREATE TABLE USER_VERIFICATION
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    SECRET     VARCHAR2(255) NOT NULL,
    EXPIRES_AT TIMESTAMP WITH TIME ZONE,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    USER_ID    NUMBER UNIQUE                                      NOT NULL REFERENCES USERS (ID) ON DELETE CASCADE,
    PRIMARY KEY (id)
);


CREATE TABLE VOUCHER
(
    ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    "NAME"          VARCHAR2(255) NOT NULL,
    DISCOUNT_AMOUNT NUMBER                                             NOT NULL,
    UNIT            VARCHAR(255)                                       NOT NULL,
    STARTS_AT       TIMESTAMP WITH TIME ZONE                           NOT NULL,
    EXPIRES_AT      TIMESTAMP WITH TIME ZONE                           NOT NULL,
    CREATED_AT      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    QUANTITY        NUMBER                                             NOT NULL,
    USED_AMOUNT     NUMBER                                             NOT NULL,
    TYPE            VARCHAR2(255) NOT NULL,
    STATUS          VARCHAR2(255) NOT NULL,
    PRIMARY KEY (ID)
);

CREATE TABLE ORDERS
(
    ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CREATED_AT      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT      TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    STATUS          VARCHAR2(255) NOT NULL,
    TOTAL_PRICE     NUMBER                                             NOT NULL,
    USER_ID         NUMBER                                             NOT NULL REFERENCES USERS (ID),
    VOUCHER_ID      NUMBER                                             NOT NULL REFERENCES VOUCHER (ID),
    DISCOUNT_AMOUNT NUMBER                                             NOT NULL,
    UNIT            VARCHAR(255)                                       NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE BRAND
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    "NAME"     VARCHAR2(255) NOT NULL,
    CODE       VARCHAR(255)                                       NOT NULL,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE PRODUCT
(
    ID          NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    "NAME"      VARCHAR2(255) NOT NULL,
    DESCRIPTION VARCHAR2(2000) NOT NULL,
    STATUS      VARCHAR2(255) DEFAULT 'ACTIVE' NOT NULL,
    BRAND_ID    NUMBER                                             NOT NULL REFERENCES BRAND (ID),
    CREATED_AT  TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT  TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    THUMBNAIL   NUMBER NULL REFERENCES FILES(id),
    PRIMARY KEY (ID)
);


CREATE TABLE PRODUCT_VARIANT
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    PRICE      NUMBER                                             NOT NULL,
    STOCK      NUMBER                                             NOT NULL,
    PRODUCT_ID NUMBER                                             NOT NULL REFERENCES PRODUCT (ID) ON DELETE CASCADE,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE PRODUCT_ATTRIBUTE
(
    ID                 NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CODE               VARCHAR2(255) NOT NULL,
    VALUE              VARCHAR2(255) NOT NULL,
    PRODUCT_VARIANT_ID NUMBER                                             NOT NULL REFERENCES PRODUCT_VARIANT (ID) ON DELETE CASCADE,
    CREATED_AT         TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT         TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (ID)
);

CREATE TABLE PRODUCT_VARIANT_IMAGE
(
    ID                 NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    PRODUCT_VARIANT_ID NUMBER                                             NOT NULL REFERENCES PRODUCT_VARIANT (id) ON DELETE CASCADE,
    FILE_ID            NUMBER                                             NOT NULL REFERENCES FILES (id),
    CREATED_AT         TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT         TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (ID)
);


CREATE TABLE CART
(
    ID                 NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    CREATED_AT         TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT         TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    QUANTITY           NUMBER CHECK (QUANTITY >= 0),
    PRODUCT_VARIANT_ID NUMBER                                             NOT NULL REFERENCES PRODUCT_VARIANT (ID) ON DELETE CASCADE,
    USER_ID            NUMBER                                             NOT NULL REFERENCES USERS (ID) ON DELETE CASCADE,
    PRIMARY KEY (id)
);


CREATE TABLE VOUCHER_CONSTRAINT_USER
(
    ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    VOUCHER_ID      NUMBER NOT NULL REFERENCES VOUCHER (ID) ON DELETE CASCADE,
    CONSTRAINT_TYPE VARCHAR2(255) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE VOUCHER_CONSTRAINT_PRODUCT
(
    ID              NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    VOUCHER_ID      NUMBER NOT NULL REFERENCES VOUCHER (ID) ON DELETE CASCADE,
    CONSTRAINT_TYPE VARCHAR2(255) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE VOUCHER_CONSTRAINT_PRODUCT_DETAIL
(
    ID                            NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    PRODUCT_ID                    NUMBER NOT NULL REFERENCES PRODUCT (ID) ON DELETE CASCADE,
    VOUCHER_CONSTRAINT_PRODUCT_ID NUMBER NOT NULL REFERENCES VOUCHER_CONSTRAINT_PRODUCT (ID) ON DELETE CASCADE,
    PRIMARY KEY (id)
);

CREATE TABLE ORDER_DETAIL
(
    ID                 NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    PRODUCT_PRICE      NUMBER NOT NULL,
    QUANTITY           NUMBER NOT NULL,
    PRODUCT_VARIANT_ID NUMBER NOT NULL REFERENCES PRODUCT_VARIANT (ID),
    VOUCHER_ID         NUMBER REFERENCES VOUCHER (ID),
    ORDER_ID           NUMBER NOT NULL REFERENCES ORDERS (ID),
    DISCOUNT_AMOUNT    NUMBER,
    UNIT               VARCHAR(255),
    PRIMARY KEY (id)
);


CREATE TABLE ADMIN
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    "NAME"     VARCHAR2(255),
    PASSWORD   VARCHAR2(255) NOT NULL,
    EMAIL      VARCHAR2(255) UNIQUE NOT NULL,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE USER_VOUCHER
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    VOUCHER_ID NUMBER                                             NOT NULL REFERENCES VOUCHER (ID),
    USER_ID    NUMBER                                             NOT NULL REFERENCES USERS (ID),
    IS_USED    NUMBER(1,0) DEFAULT 1 NOT NULL,
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE REVIEW
(
    ID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    ORDER_ID   NUMBER                                             NOT NULL REFERENCES ORDER_DETAIL (ID) ON DELETE CASCADE,
    PRODUCT_ID NUMBER                                             NOT NULL REFERENCES PRODUCT (ID) ON DELETE CASCADE,
    STATUS     VARCHAR2(255) NOT NULL,
    RATING     NUMBER,
    "COMMENT"    VARCHAR2(1000),
    CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    PRIMARY KEY (id)
)

